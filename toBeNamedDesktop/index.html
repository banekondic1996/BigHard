<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resizable Div Bar</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background:url('imgT.jpg'); 
            background-repeat: no-repeat;
  			background-size: cover;     
            }

        #barID {
            max-height: 100px;
            min-height: 22px;
            display: flex;
            width: 96%;
            height: 32px;
            background-color: #f0f0f099;
            position: absolute;
            /* cursor: ns-resize; */
            align-items: center;
            bottom: 45px;
            border-radius: 18px;
            overflow: hidden;
            padding-inline: 1%;
            margin-inline: 1%;
            user-select: none;
            backdrop-filter: blur(2px);
        }
        #select {
            display: none;
            background: #0000005c;
            position: absolute;
            border-radius: 12px;
            left: 184px;
            top: 211px;
            transform-origin: left top;
            z-index: 999;
           /*  height: 171px;
            width: 136px; */
        }
#iconTask{
height:auto;width:22px;margin-left: 6px;

} 
.taskbutton{
    margin-inline-end: 5px;
    height: 40%;
    aspect-ratio: 1/1;
    background: #00000021;
    border-radius: 100%;
    padding: 5px;
    display: flex;
    align-items: center;
    justify-content: center;
}
.taskbutton:hover{
    background: #00000037;
}
.desktopIcon{
    display: flex;
    background-color:rgb(255 51 51 / 22%);
    width: 60px;
    height: 60px;
    margin: 3px;
    padding: 5px;
    user-select: none;
}
.desktopIconIn{
    border-radius: 5px;
    height: 60px;
    width: 60px;
    flex-direction: column;
    align-items: center;
    margin: auto;
    overflow: hidden;
    text-align-last: center;
    user-select: all;
    -webkit-user-drag: element;
    position: absolute;
    cursor: move;
    z-index: 10;
}
.desktopIconIn:hover{
    background-color: rgba(255, 255, 255, 0.268);
    height: auto;
}
.desktopIconIn:active{
    background-color: rgba(255, 255, 255, 0.452);
    height: auto;
}
.desktopIconIn img{
    user-select: none;
    height: 42px;
    width: 42px;
    user-select: none;
    -webkit-user-drag: none;
}
.desktopIconInText{
    margin-top: -6px;
    text-align: center;
    color: white;
    text-shadow: 1px 1px 3px #7c7c7c;
    text-overflow: clip;
    user-select: none;
    -webkit-user-drag: none;
}
#barResizeID{
    display: flex;
    width: 96%;
    height: 40px;
    position: absolute;
    /* cursor: ns-resize; */
    align-items: center;
    bottom: 45px;
    border-radius: 18px;
    overflow: hidden;
    padding-inline: 1%;
    margin-inline: 1%;
    cursor:n-resize;
}
#barClockID{
    display: flex;
    height: 40%;
    background: #0000001a;
    border-radius: 24px;
    padding: 4px;
    padding-inline: 10px;
    font-size: 14px;
 /*    font-size: 12px;
    font-family: system-ui; */
    align-items: center;
}
.contextMenu{
    display: none;
    position: absolute;
    /* width: 134px; */
    /* height: 271px; */
    background-color: rgb(228, 228, 228);
    opacity: 0.8;
    border: none;
    border-radius: 10px;
    overflow: hidden;
    z-index: 222;
    /* text-align: center; */
    left: 116px;
    top: 50px;
  }
  .contextMenu tr td{
    border-radius: 10px;
    /* text-align: center; */
    text-wrap: nowrap;
    padding: 8px;
  }
  .contextMenu tr td:hover{
    background:rgb(124, 124, 124);
    text-align: center;
  }
  .icons{
    display: flex;
    background: #fffefe;
    padding: 6px;
  }
  .contextMenu tr th img:hover{
    border-radius: 100%;
    background:rgb(236, 236, 236);
  }
  .contextMenu tr th img{
        padding:5px;
  }
  
/* .WindowContainer{
    contain: content;
    height: 400px;
    width: 400px;
    border-radius: 10px;
    position: absolute;
    z-index: 999;
}
.WindowBar{
    background-color: #f0f0f099;
    height: 32px;
    width: 100%;
}
.WindowContent{
    width: 100%;
    height: 100%;
    background:white;
} */
</style>
</head>
<body>  
<!--     <div class="contextMenu" id="contextMenuVideo">
        <table style="width: 100%;display: flex;">
        <tbody style="width: 100%;display: flex;flex-direction: column;align-items: center;">
        <tr onclick="">
            <th style="display: flex;flex-direction: row;">
         <div class="icons" style="display: flex;">
         <img src="/icons/copy.png" style="height: 24px;">
        </div>
         <div class="icons" style="display: flex;">
        <img src="/icons/cut.png" style="height: 24px;margin: auto;"></div>
        <div class="icons" style="display: flex;">
        <img src="/icons/paste.png" style="height: 24px;"></div>
        <div class="icons" style="display: flex;">
        <img src="/icons/edit-file.png" style="height: 24px;"></div>
        </th>
        </tr>
        <tr onclick=""><td>Run as admin/root</td></tr>
        <tr onclick=""><td>Open with</td></tr>
        <tr onclick=""><td>Open conditional</td></tr>
        <tr onclick=""><td>Compress</td></tr>
        <tr><td>Copy path</td></tr>
        <tr><td>Take Ownership</td></tr><tr><td>Properties</td></tr></tbody></table>
        </div> -->

        <div class="contextMenu" id="contextMenuID">
            <table style="width: 100%;display: flex;">
            <tbody style="width: 100%;display: flex;flex-direction: row;align-items: center;">
            <tr onclick="">
                <th style="display: flex;flex-direction: column;">
             <div class="icons" style="display: flex;">
             <img alt="Copy" src="/icons/copy.png" style="height: 24px;">
            </div>
             <div class="icons" style="display: flex;">
            <img alt="Cut" src="/icons/cut.png" style="height: 24px;margin: auto;"></div>
            <div class="icons" style="display: flex;">
            <img alt="Paste" src="/icons/paste.png" style="height: 24px;"></div>
            <div class="icons" style="display: flex;" onmouseenter="console.log('hell');">
            <img alt="Respawn" src="/icons/reload.png" style="height: 24px;" ></div>
            <div class="icons" style="display: flex;">
             <img alt="Settings" src="/icons/settings.png" style="height: 24px;">
            </div><div class="icons" style="display: flex;">
             <img  alt="New" src="/icons/add.png" style="height: 24px;">
            </div></th>
            </tr>
            </tbody></table>
            </div>

    <input style="accent-color: #d8fd87;opacity: 0.5;margin: 10px;position: absolute;z-index: 999;" type="range" min=0 max=1 step=0.01 name="volume" id="" oninput="console.log(this.value); volume.invokeCommand('[audio]::Volume='+this.value+';')">
    <webview id="transferDialogID" allowtransparency allownw style="position: absolute;z-index: 10000;width: 650px;height: 277px;bottom: 78px;display: block;" partition="trusted" src="/transferDialog/transferDialog.html" type=""></webview>
    <!-- <webview id="controlCenterID" allowtransparency allownw style="position: absolute;z-index: 10000;width: 350px;height: 507px;bottom: 78px;display: none;" partition="trusted" src="C:/Users/X.000000000000000000/Desktop/controlcenter/controlCenter.html" type=""></webview> -->
  <!--   <div class="WindowContainer">
        <div class="WindowBar">
            <div class="taskbutton" onclick="" style="right: 0px;top: 4px;position: absolute;background: #ffaeae8f;width: 84px;height: 13px;margin-inline-end: 5px;border-radius: 18px;padding: 5px;"></div><div class="taskbutton" onclick="" style="right: 69px;top: 9px;position: absolute;background: #f5f5f5;width: 8px;height: 3px;margin-inline-end: 5px;border-radius: 18px;padding: 5px;"></div>
            <div class="taskbutton" onclick="" style="right: 48px;top: 9px;position: absolute;background: #f0f0f0;width: 8px;height: 3px;margin-inline-end: 5px;border-radius: 18px;padding: 5px;"></div>
            <div class="taskbutton" onclick="" style="font-size: 7px;right: 27px;top: 9px;position: absolute;background: #f3f3f3;width: 8px;height: 3px;margin-inline-end: 5px;border-radius: 18px;padding: 5px;"></div>
        <div class="taskbutton" onclick="" style="right: 6px;top: 9px;position: absolute;background: #f5f5f5;width: 8px;height: 3px;margin-inline-end: 5px;border-radius: 18px;padding: 5px;"></div></div>
        <div class="WindowContent"></div>
    </div> -->
    <div id="desktopID" style="
    position: absolute;
    display: block;
    height: 100%;
    width: 100%;">
    <div id="desktopGridID" class="desktopGrid" style="display: flex;height: 93%;width: 100%;margin: auto;flex-direction: row;flex-wrap: wrap;align-items: center;justify-content: center;">

        <div class="desktopIcon" draggable="false"><div id="desktopIcon1" class="desktopIconIn"><img src="/chrome.png" alt=""><div class="desktopIconInText">Google Chrome</div></div></div>
    <div class="desktopIcon" style=""><div class="desktopIconIn"><img src="/chrome.png" alt=""><div class="desktopIconInText">Google Chrome</div></div></div><div class="desktopIcon" style="" draggable="false"><div class="desktopIconIn"><img src="/chrome.png" alt=""><div class="desktopIconInText">Google Chrome</div></div></div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="" draggable="false">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div>
    <div class="desktopIcon" style="" draggable="false">2</div><div class="desktopIcon" draggable="false" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="" draggable="false">1</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="" draggable="false">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div>
    <div class="desktopIcon" draggable="false" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="" draggable="false">1</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="" draggable="false">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div>
    <div class="desktopIcon" draggable="false" style=""></div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="" draggable="false">1</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="" draggable="false">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div>
    <div class="desktopIcon" draggable="false" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="" draggable="false">1</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="" draggable="false">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div>
    <div class="desktopIcon" draggable="false" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="" draggable="false">1</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="" draggable="false">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div>
    <div class="desktopIcon" draggable="false" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="" draggable="false">1</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="" draggable="false">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div>
    <div class="desktopIcon" draggable="false" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="" draggable="false">1</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="" draggable="false">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">1</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div>
    <div class="desktopIcon" draggable="false" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="" draggable="false">1</div><div class="desktopIcon" style=""><div class="desktopIconIn"><img src="/empty_trash.png" alt=""><div class="desktopIconInText">Mr. Bin</div></div></div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="" draggable="false">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div>
    </div>
</div>
<div id="barResizeID"></div>
    <div id="barID">
        
        <div class='taskbutton' onclick="toggleControlCenter();"></div>
        <div id="barAppsID" style="display: flex;align-items: center;margin:auto;height: 100%;">
      <img class="taskbutton" src="/set/repeat.png" onclick="getBarIcons()">
      <img id='iconTest'src="">
        </div>
        <div id="barClockID" style=""></div>
    </div>
    <div id="select"></div>

    <script>
        console.log("width="+window.innerWidth);
        let AppProcessID=nw.process.ppid;
         let barElement=document.getElementById('barAppsID');
         let desktopGridElement=document.getElementById('desktopGridID');
         let desktopGridHeight=desktopGridElement.offsetHeight;
         let desktopGridWidth=desktopGridElement.offsetWidth;
         let desktopGridFields=Math.floor(desktopGridWidth/76)*Math.floor(desktopGridHeight/76);
         let desktopIcons=[
            {
                name:"Google Chrome",
                icon:"/chrome.png",
                gridPosition:0,
            },
            {
                name:"Google Chrome",
                icon:"/chrome.png",
                gridPosition:1,
            },
            {
                name:"Mr. Bin",
                icon:"/empty_trash.png",
                gridPosition:179,
            }

         ];
         var win=nw.Window.get();
         var iconExtractor = require('icon-extractor');
         var PowerShell = require("node-powershell");
         var Yes=new PowerShell.PowerShell;
         var bottomShell=new PowerShell.PowerShell;
         var showORhideShell=new PowerShell.PowerShell;
         var volume=new PowerShell.PowerShell;
         var resultObject;
         var num=0;
         /* var Grid=[]; */
         function spawnDesktopGrid(){
            desktopGridElement.innerHTML="";
            for(let i=0;desktopGridFields>i;i++)
         {
            console.log("spawn "+i)
            desktopGridElement.innerHTML=desktopGridElement.innerHTML+`<div class="desktopIcon" draggable="false" style="">`+i+`</div>`
            /* Grid.push({cell :i , offsetTop:desktopGridElement.children[i].offsetTop,offsetLeft:desktopGridElement.children[i].offsetLeft}); */
         }
         }
         function spawnDesktopIcons(){
            desktopIcons.forEach(el => {
                    if(el.gridPosition>=0){
                    desktopGridElement.children[el.gridPosition].innerHTML=`<div class="desktopIconIn"><img src="`+el.icon+`" alt=""><div class="desktopIconInText">`+el.name+`</div></div>`;
                    dragElement(desktopGridElement.children[el.gridPosition].children[0]);
                }
                });
         }
         function hideDesktopIcons(){
            spawnDesktopGrid();
         }
         function showDesktopIcons(){
            spawnDesktopGrid();
            spawnDesktopIcons();
         }
       /*   function snapDesktopIconToGrid(){
            var Cell1=desktopGridElement.children[3].offsetTop;
            var Cell2=desktopGridElement.children[3].offsetTop;
            var Cell3=desktopGridElement.children[3].offsetTop;
            var Cell4=desktopGridElement.children[3].offsetTop;
         } */
         spawnDesktopGrid();
         spawnDesktopIcons();
      /*    function PowerShellCommand(command){
            var newPowerShell=new PowerShell.PowerShell;
            newPowerShell.invokeCommand(command);
         } */
        volume.invokeCommand("C:/Users/X.000000000000000000/VolumeAndMute.ps1");
         Yes.invokeCommand("C:/Users/X.000000000000000000/procesess.ps1").then(result => {
            const lines = result.raw.split('\n').map(line => line.trim()).filter(line => line !== "");
            resultObject = lines.map(line => {
                    const [id, title, path] = line.split(',').map(value => value.trim());
                    return {
                        Id: id,
                        MainWindowTitle: title,
                        Path: path,
                        Icon:""
                    };
                });
                resultObject.forEach(element => {
                    
                });
                console.log(resultObject);  
                console.log(resultObject.length);
            console.log(result.raw); // "Operation succeeded!"
            })
            iconExtractor.emitter.on('icon', function(data)
            {
                resultObject[num].Icon="data:image/png;base64,"+data.Base64ImageData+"";
                refreshBarIcons();                            
            });
            function getBarIcons(){
                var len=resultObject.length;
                var time=100;
                if(num<len){
                for(let i=0;i<len;i++)
                {
                    setTimeout(() => {
                    console.log("Delayed for 1 second.");
                    getBarIcon(i);
                    }, time);
                    time=time+100;
                }
            }
        }
        function getBarIcon(numB){
            num=numB;
           /*  iconExtractor.emitter.on('icon', function(data)
                            {
                                resultObject[num].Icon="data:image/png;base64,"+data.Base64ImageData+"";
                            }); */
            iconExtractor.getIcon("",resultObject[num].Path.replace(/\\/g, '/'));           
        }
        function refreshBarIcons(){
            barElement.innerHTML="";
            resultObject.forEach(element => 
            {
                barElement.innerHTML=barElement.innerHTML+`<img class="taskbutton" id='`+element.Id+`' src="`+element.Icon+`" title="`+element.MainWindowTitle+`" onclick='showORhideAPP(`+element.Id+`)'>`;
            });  
        }
        function showORhideAPP(processID){
            console.log("Trying to show: "+processID);
            showORhideShell.invokeCommand("C:/Users/X.000000000000000000/procesessB.ps1 -Style 'SHOWDEFAULT' -processID "+processID+"");
        }
        let monthsList=["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
        function startTime() {
            const today = new Date();
            let month=today.getMonth();
            let date=today.getDate();
            let h = today.getHours();
            let m = today.getMinutes();
            m = checkTime(m);
            document.getElementById('barClockID').innerHTML =  date+" "+monthsList[month]+" "+ h + ":" + m ;
            setTimeout(startTime, 60000);
            }
        function checkTime(i) {
            if (i < 10) {i = "0" + i};  // add zero in front of numbers < 10
            return i;
            }
            const os = require('node:os');
        var win = nw.Window.get();
        let bar=document.getElementById('select');
        let desktopElement=document.getElementById('desktopID');
        win.resizeTo(1920,1080);
       /*  win.enterKioskMode(); */
        /* win.setAlwaysOnTop(True); */
        /* win.showDevTools(); */
        console.log(nw);
        startTime();
        /* win.blur();  */
        document.addEventListener('DOMContentLoaded', function () {
            var isResizing = false;
            var lastY;
            var lastX;
            var mouseDown=false;
            var resizableBarBorder = document.getElementById('barResizeID');
            var contextMenuElement = document.getElementById('contextMenuID');
            var resizableBar = document.getElementById('barID');
            resizableBarBorder.addEventListener('mousedown', function (e) {
                e.stopPropagation();
                isResizing = true;
                lastY = e.clientY;
   /*              lastX = e.clientX; */
            });
            resizableBarBorder.addEventListener('mousemove', function (e) {
                console.log(e.srcElement.style.cursor);
            });
            document.addEventListener('contextmenu', function(e) 
            {
                contextMenuElement.style.display="block";
                contextMenuElement.style.left=e.clientX+"px";
                contextMenuElement.style.top=e.clientY+"px";
                /* e.preventDefault(); */
            }, false);
            document.addEventListener('mousemove', function (e) {
                if (isResizing) {
                    var deltaY = e.clientY - lastY;
                    var contentHeight = resizableBar.offsetHeight;
                    resizableBarBorder.style.height = (contentHeight - deltaY)+5 + 'px';
                    resizableBar.style.height = (contentHeight - deltaY) + 'px';
                    lastY = e.clientY;

                 /*    var deltaX = e.clientX - lastX;
                    var contentWidth = resizableBar.offsetWidth;
                    resizableBarBorder.style.width = (contentWidth  - deltaX)+5 + 'px';
                    resizableBar.style.width = (contentWidth - deltaX) + 'px';
                    lastX = e.clientX; */
                }
            });

            document.addEventListener('mouseup', function () {
                isResizing = false;
                mouseDown=false;
                bar.style.display="none";
                console.log("mouseup");
            });
            window.addEventListener("click", function(event) {
                bottomShell.invokeCommand("C:/Users/X.000000000000000000/Desktop/bottomMe.ps1 "+AppProcessID+" ");
            });
            document.addEventListener('mousedown', function () {
                contextMenuElement.style.display="none";
                if (event.target.className != "desktopIconIn"){
                    console.log("mousedown");
                mouseDown=true;
                bar.style.height="0px";
                bar.style.width="0px";
                bar.style.display="block";
                bar.style.top=event.clientY+"px";
                bar.style.left=event.clientX+"px";
                 
                }
              
                console.log(event);
            });
            document.addEventListener('mousemove', function () {
                console.log("mousemove");
                if(mouseDown){
                    console.log("mousedown & mousemove");
                    let selectHeight=event.clientY-bar.offsetTop;
                    let selectWidth=event.clientX-bar.offsetLeft;
                    if(selectHeight>0&selectWidth>0){
                        bar.style.transform="rotate(0deg)";
                        bar.style.translate="0%";
                        bar.style.height=selectHeight+"px";
                        bar.style.width=selectWidth+"px";
                    }
                    if(selectHeight<0&selectWidth>0){
                        bar.style.transform="rotate(180deg)";
                        bar.style.translate="100%";
                        bar.style.height=Math.abs(selectHeight)+"px";
                        bar.style.width=selectWidth+"px";
                    }
                    if(selectHeight>0&selectWidth<0){
                        bar.style.transform="rotate(0deg)";
                        bar.style.translate="-100%";
                        bar.style.height=selectHeight+"px";
                        bar.style.width=Math.abs(selectWidth)+"px";
                    }
                    if(selectHeight<0&selectWidth<0){
                        bar.style.transform="rotate(180deg)";
                        bar.style.translate="0%";
                        bar.style.height=Math.abs(selectHeight)+"px";
                        bar.style.width=Math.abs(selectWidth)+"px";
                    }
                console.log("eventY:"+event.clientY);
                console.log("barTop:"+bar.offsetTop);
            }
            });
        });
        // Make the DIV element draggable:
/* let dragableIcons=document.getElementsByClassName("desktopIconIn");
for(let i=0;dragableIcons.length;i++){
    dragElement(dragableIcons[i]);
} */
function closest(array, num) {
  var i = 0;
  var minDiff = 1000;
  var ans;
  for (i in array) {
    var m = Math.abs(num - array[i]);
    if (m < minDiff) {
      minDiff = m;
      ans = array[i];
    }
  }
  return ans;
}
function dragElement(elmnt) {
  var pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
  elmnt.onmousedown = dragMouseDown;


  function dragMouseDown(e) {
    e.stopPropagation();
    e = e || window.event;
    e.preventDefault();
    // get the mouse cursor position at startup:
    pos3 = e.clientX;
    pos4 = e.clientY;
    document.onmouseup = closeDragElement;
    // call a function whenever the cursor moves:
    document.onmousemove = elementDrag;
  }

  function elementDrag(e) {
    e = e || window.event;
    e.preventDefault();
    // calculate the new cursor position:
    pos1 = pos3 - e.clientX;
    pos2 = pos4 - e.clientY;
    pos3 = e.clientX;
    pos4 = e.clientY;
    // set the element's new position:
    elmnt.style.top = (elmnt.offsetTop - pos2) + "px";
    elmnt.style.left = (elmnt.offsetLeft - pos1) + "px";
  }

  function closeDragElement() {
    var cell=Math.round((elmnt.offsetTop)/82)*20+(Math.round((76+elmnt.offsetLeft)/76))-1;
    console.log("the element offsetTop= "+elmnt.offsetTop);
    console.log("the element offsetLeft= "+elmnt.offsetLeft);
    console.log("the element row= "+Math.round((76+elmnt.offsetTop)/76));
    console.log("the element column= "+Math.round((76+elmnt.offsetLeft)/76));
    console.log("Cell ="+cell);
  /*   elmnt.style.top=desktopGridElement.children[cell].offsetTop+"px";
    elmnt.style.left=desktopGridElement.children[cell].offsetLeft+"px"; */
    elmnt.style.top=null;
    elmnt.style.left=null;
    if(desktopGridElement.children[cell].children[0]==null){
    desktopGridElement.children[cell].append(elmnt);
}
    // stop moving when mouse button is released:
    document.onmouseup = null;
    document.onmousemove = null;
  }
}
/* var windowEdgyOpt = { "title": "Edgy", "frame": false, "fullscreen": true, "transparent": true, "resizable": true, "position":"center","show": true, "always_on_top": true };
nw.Window.open("/edgy/edgy.html",windowEdgyOpt,function(newWindow) {
                        edgyWindow = newWindow;
                    }); */
var controlWindowOn=false;
/* let controlCenterElement=document.getElementById("controlCenterID"); */
var windowOpts = { "title": "Control Center", "frame": false, "fullscreen": false, "transparent": true, "width": 340, "height": 503, "resizable": false, "show": true, "always_on_top": true };
function toggleControlCenter(){
    if (controlWindowOn==false){
        nw.Window.open("/controlCenter/controlcenter.html",windowOpts,function(newWindow) {
                        controlWindow = newWindow;
                        controlWindow .window.moveTo(15,287)
                        controlWindowOn=true;
                    });
        /* controlCenterElement.style.display="block"; */
    }
    else if (controlWindowOn==true){
        controlWindow.window.close();
        controlWindowOn=false;
        /* controlCenterElement.style.display="none"; */
    }
}

/* nw.Window.open("/controlCenter/controlcenter.html",windowOpts,function(newWindow) {
                        newWindow.window.moveTo(15,287);
                        controlWindow = newWindow;
                    }); */
/* let dragableIcons=document.getElementById("desktopGridD"); */
/* const fs = require('fs');
async function copy() 
      {
        const sourceFile = 'copyTest.iso'
const destFile = 'copyTest_done.iso'

fs.stat(sourceFile, function(err, stat){
  const filesize = stat.size
  let bytesCopied = 0
  let bufferR=0; 
  const readStream = fs.createReadStream(sourceFile)

  readStream.on('data', function(buffer){
    bufferR =bufferR+ buffer.length;
  })
  readStream.on('end', function(){
    console.log("done");
    console.timeEnd('copying')
  })
  setInterval(() => {
        let prcentage = ((bufferR/filesize)*100).toFixed(2)
        console.log(prcentage+'%') 
    }
    , 1000);
  readStream.pipe(fs.createWriteStream(destFile));
});
      };
copy(); */

    </script>
     <script src="./Sortable.js"></script>
     <script>
       new Sortable(barElement, {
       animation: 200,
       ghostClass: 'blue-background-class'
     });
   /*   new Sortable(dragableIcons , {
       animation: 200,
       ghostClass: 'blue-background-class'
     }); */
     </script>
</body>
</html>

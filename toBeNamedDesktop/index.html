<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resizable Div Bar</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background:url('imgT.jpg'); 
            background-repeat: no-repeat;
  			background-size: cover;     
            }

        #barID {
            max-height: 100px;
            min-height: 22px;
            display: flex;
            width: 96%;
            height: 32px;
            background-color: #f0f0f099;
            position: absolute;
            /* cursor: ns-resize; */
            align-items: center;
            bottom: 45px;
            border-radius: 18px;
            overflow: hidden;
            padding-inline: 1%;
            margin-inline: 1%;
            user-select: none;
            backdrop-filter: blur(2px);
        }
        #select {
            display: none;
            background: #0000005c;
            position: absolute;
            border-radius: 12px;
            left: 184px;
            top: 211px;
            transform-origin: left top;
            z-index: 999;
           /*  height: 171px;
            width: 136px; */
        }
#iconTask{
height:auto;width:22px;margin-left: 6px;
} 
.taskbutton{
    margin-inline-end: 5px;
    height: 40%;
    aspect-ratio: 1/1;
    background: #00000021;
    border-radius: 100%;
    padding: 5px;
    display: flex;
    align-items: center;
    justify-content: center;
}
.taskbutton:hover{
    background: #00000037;
}
.windowButton{
    position: absolute;
    margin-inline-end: 5px;
    width: 4px;
    height: 3px;
    aspect-ratio: 1/1;
    border-radius: 100%;
    padding: 5px;
    display: flex;
    align-items: center;
    justify-content: center;
}
.windowButton:hover{
    scale:1.2;
}
.desktopIcon{
    display: flex;
    background-color:rgb(255 51 51 / 22%);
    width: 60px;
    height: 60px;
    margin: 3px;
    padding: 5px;
    user-select: none;
}
.desktopIconIn{
    border-radius: 5px;
    height: 60px;
    width: 60px;
    flex-direction: column;
    align-items: center;
    margin: auto;
    overflow: hidden;
    text-align-last: center;
    user-select: all;
    -webkit-user-drag: element;
    position: absolute;
    cursor: move;
    z-index: 10;
}
.desktopIconIn:hover{
    background-color: rgba(255, 255, 255, 0.268);
    height: auto;
}
.desktopIconIn:active{
    background-color: rgba(255, 255, 255, 0.452);
    height: auto;
}
.desktopIconIn img{
    user-select: none;
    height: 42px;
    width: 42px;
    user-select: none;
    -webkit-user-drag: none;
}
.desktopIconInText{
    margin-top: -6px;
    text-align: center;
    color: white;
    text-shadow: 1px 1px 3px #7c7c7c;
    text-overflow: clip;
    user-select: none;
    -webkit-user-drag: none;
}
#barResizeID{
    display: flex;
    width: 96%;
    height: 40px;
    position: absolute;
    /* cursor: ns-resize; */
    align-items: center;
    bottom: 45px;
    border-radius: 18px;
    overflow: hidden;
    padding-inline: 1%;
    margin-inline: 1%;
    cursor:n-resize;
}
#barClockID{
    display: flex;
    height: 40%;
    background: #0000001a;
    border-radius: 24px;
    padding: 4px;
    padding-inline: 10px;
    font-size: 14px;
 /*    font-size: 12px;
    font-family: system-ui; */
    align-items: center;
}
.contextMenu{
    display: none;
    position: absolute;
    /* width: 134px; */
    /* height: 271px; */
    background-color: rgb(228, 228, 228);
    opacity: 0.8;
    border: none;
    border-radius: 10px;
    overflow: hidden;
    z-index: 222;
    /* text-align: center; */
    left: 116px;
    top: 50px;
  }
  .contextMenu tr td{
    border-radius: 10px;
    /* text-align: center; */
    text-wrap: nowrap;
    padding: 8px;
  }
  .contextMenu tr td:hover{
    background:rgb(124, 124, 124);
    text-align: center;
  }
  .icons{
    display: flex;
    background: #fffefe;
    padding: 6px;
  }
  .contextMenu tr th img:hover{
    border-radius: 100%;
    background:rgb(236, 236, 236);
  }
  .contextMenu tr th img{
        padding:5px;
  }
  
.WindowContainer{
 /* display: none; */
 width: 569px;
    height: 270px;
    background: #c6c6c663;
    position: absolute;
    left: 12px;
    top: 486px;
    border-radius: 14px;
    backdrop-filter: blur(11px);
    box-shadow: 0px 0px 20px 6px #00000038;
    /* filter: blur(3px); */
    z-index: 999;
}
/* .WindowBar{
    background-color: #f0f0f099;
    height: 32px;
    width: 100%;
}
.WindowContent{
    width: 100%;
    height: 100%;
    background:white;
} */
 .buttonsHolder{
    right: 0px;top: 4px;position: absolute;background: #27272745;width: 81px;height: 13px;margin-inline-end: 5px;border-radius: 18px;padding: 5px;
 }
</style>
</head>
<body>  
<!--     <div class="contextMenu" id="contextMenuVideo">
        <table style="width: 100%;display: flex;">
        <tbody style="width: 100%;display: flex;flex-direction: column;align-items: center;">
        <tr onclick="">
            <th style="display: flex;flex-direction: row;">
         <div class="icons" style="display: flex;">
         <img src="/icons/copy.png" style="height: 24px;">
        </div>
         <div class="icons" style="display: flex;">
        <img src="/icons/cut.png" style="height: 24px;margin: auto;"></div>
        <div class="icons" style="display: flex;">
        <img src="/icons/paste.png" style="height: 24px;"></div>
        <div class="icons" style="display: flex;">
        <img src="/icons/edit-file.png" style="height: 24px;"></div>
        </th>
        </tr>
        <tr onclick=""><td>Run as admin/root</td></tr>
        <tr onclick=""><td>Open with</td></tr>
        <tr onclick=""><td>Open conditional</td></tr>
        <tr onclick=""><td>Compress</td></tr>
        <tr><td>Copy path</td></tr>
        <tr><td>Take Ownership</td></tr><tr><td>Properties</td></tr></tbody></table>
        </div> -->

        <div class="contextMenu" id="contextMenuID">
            <table style="width: 100%;display: flex;">
            <tbody style="width: 100%;display: flex;flex-direction: row;align-items: center;">
            <tr onclick="">
                <th style="display: flex;flex-direction: column;">
             <div class="icons" style="display: flex;">
             <img alt="Copy" src="/icons/copy.png" style="height: 24px;">
            </div>
             <div class="icons" style="display: flex;">
            <img alt="Cut" src="/icons/cut.png" style="height: 24px;margin: auto;"></div>
            <div class="icons" style="display: flex;">
            <img alt="Paste" src="/icons/paste.png" style="height: 24px;"></div>
            <div class="icons" style="display: flex;" onmouseenter="console.log('hell');">
            <img alt="Respawn" src="/icons/reload.png" style="height: 24px;" ></div>
            <div class="icons" style="display: flex;">
             <img alt="Settings" src="/icons/settings.png" style="height: 24px;">
            </div><div class="icons" style="display: flex;">
             <img  alt="New" src="/icons/add.png" style="height: 24px;">
            </div></th>
            </tr>
            </tbody></table>
            </div>

    <input style="accent-color: #d8fd87;opacity: 0.5;margin: 10px;position: absolute;z-index: 999;" type="range" min=0 max=1 step=0.01 name="volume" id="" oninput="console.log(this.value); volume.invokeCommand('[audio]::Volume='+this.value+';')">
    <webview id="transferDialogID"  allowtransparency allownw style="position: absolute;z-index: 10000;width: 850px;height: 477px;bottom: 78px;display: block;" partition="trusted" src="/transferDialog/transferDialog.html" type=""></webview>
    <webview id="mediaCenterID" alwaysontop allowtransparency allownw style="position: absolute;z-index: 10000;width: 311px;height: 177px;left:600px;bottom:94px;display: block;" partition="trusted" src="/volumeControl/mediaCenter.html" type=""></webview>
    <webview id="calendarID" allowtransparency allownw style="position: absolute;z-index: 10000;width: 311px;height: 427px;left:1200px;bottom:94px;display: block;" partition="trusted" src="/calendar/calendar.html" type=""></webview>
    <webview id="controlCenterID" allowtransparency allownw style="position: absolute;z-index: 10000;width: 350px;height: 507px;bottom: 78px;display: none;" partition="trusted" src="C:/Users/X.000000000000000000/Desktop/controlcenter/controlCenter.html" type=""></webview>
    <!-- <div class="WindowContainer" style="">
        <div class="WindowBar">
    <div class="buttonsHolder" onclick="" style="
    display: flex;
    left: 20px;
    width: 50%;
    flex-wrap: nowrap;
    flex-direction: row;
    justify-content: center;
    align-items: center;
    color: white;
    -webkit-text-stroke-color: #dadada;
"><div style="
    display: flex;
    flex-direction: row;
    flex-wrap: nowrap;
    margin: auto;
    position: absolute;
">This is Title</div></div>
    
            <div class="buttonsHolder" onclick="" style=""></div>
            <div class="windowButton" onclick="" style="right: 69px;top: 9px;position: absolute;background: #c3c3c3;"></div>
            <div class="windowButton" onclick="" style="right: 48px;top: 9px;background: #fff49b;"></div>
            <div class="windowButton" onclick="" style="font-size: 7px;right: 27px;top: 9px;background: #cbff9b;"></div>
        <div class="windowButton" onclick="" style="right: 6px;top: 9px;background: #ff9b9b;"></div></div>
        <div class="WindowContent" style="
    background: red;
"></div>
    </div> -->

    <div id="desktopID" style="position: absolute;display: block;height: 100%;width: 100%;">
    <div id="desktopGridID" class="desktopGrid" style="display: flex;height: 93%;width: 100%;margin: auto;flex-direction: row;flex-wrap: wrap;align-items: center;justify-content: center;">
        <div class="desktopIcon" draggable="false"><div id="desktopIcon1" class="desktopIconIn"><img src="/chrome.png" alt=""><div class="desktopIconInText">Google Chrome</div></div></div>
    <div class="desktopIcon" style=""><div class="desktopIconIn"><img src="/chrome.png" alt=""><div class="desktopIconInText">Google Chrome</div></div></div><div class="desktopIcon" style="" draggable="false"><div class="desktopIconIn"><img src="/chrome.png" alt=""><div class="desktopIconInText">Google Chrome</div></div></div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="" draggable="false">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div>
    <div class="desktopIcon" style="" draggable="false">2</div><div class="desktopIcon" draggable="false" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="" draggable="false">1</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="" draggable="false">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div>
    <div class="desktopIcon" draggable="false" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="" draggable="false">1</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="" draggable="false">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div>
    <div class="desktopIcon" draggable="false" style=""></div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="" draggable="false">1</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="" draggable="false">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div>
    <div class="desktopIcon" draggable="false" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="" draggable="false">1</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="" draggable="false">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div>
    <div class="desktopIcon" draggable="false" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="" draggable="false">1</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="" draggable="false">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div>
    <div class="desktopIcon" draggable="false" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="" draggable="false">1</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="" draggable="false">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div>
    <div class="desktopIcon" draggable="false" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="" draggable="false">1</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="" draggable="false">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">1</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div>
    <div class="desktopIcon" draggable="false" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="" draggable="false">1</div><div class="desktopIcon" style=""><div class="desktopIconIn"><img src="/empty_trash.png" alt=""><div class="desktopIconInText">Mr. Bin</div></div></div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="" draggable="false">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div><div class="desktopIcon" style="">2</div>
    </div>
</div>
<div id="barResizeID"></div>
<div id="barID">
    <img class='taskbutton' src="/icons/toggle.png" onclick="openControlCenter();"></img>
    <img class="taskbutton" src="/icons/sidebar.png" onclick="openSideBar()">
    <img class="taskbutton" src="/icons/search.png" onclick="openSearch()">
    <div id="barAppsID" style="display: flex;align-items: center;margin:auto;height: 100%;">
        <img class="taskbutton" src="/icons/repeat.png" onclick="getBarIcons()">
        <img id='iconTest'src="">
    </div>
    <div id="barClockID" onclick="openCalendar()" style=""></div>
</div>
<div id="select"></div>

    <script>
         console.log("width="+window.innerWidth);
         let AppProcessID=nw.process.ppid;
         let barElement=document.getElementById('barAppsID');

         let desktopGridElement=document.getElementById('desktopGridID');
         let desktopGridHeight=desktopGridElement.offsetHeight;
         let desktopGridWidth=desktopGridElement.offsetWidth;
         let desktopGridFields=Math.floor(desktopGridWidth/76)*Math.floor(desktopGridHeight/76);
         let desktopIcons=[
            {
                name:"Google Chrome",
                icon:"/chrome.png",
                gridPosition:0,
            },
            {
                name:"Google Chrome",
                icon:"/chrome.png",
                gridPosition:1,
            },
            {
                name:"Mr. Bin",
                icon:"/empty_trash.png",
                gridPosition:179,
            }

         ];
         var win=nw.Window.get();
         var iconExtractor = require('icon-extractor');
         var PowerShell = require("node-powershell");

         var bottomShell=new PowerShell.PowerShell; //make window stay on bottom
         /* var Grid=[]; */
         
         var ProcessRunningShell=new PowerShell.PowerShell;
         var showORhideShell=new PowerShell.PowerShell;
         var volume=new PowerShell.PowerShell;
         var RunningProcessList;
         var num=0;
         var mediaCenterWebView=document.getElementById("mediaCenterID");
////////////////////////////////////////
         function spawnDesktopGrid()
         {
            desktopGridElement.innerHTML="";
            for(let i=0;desktopGridFields>i;i++)
            {
                console.log("spawn "+i)
                desktopGridElement.innerHTML=desktopGridElement.innerHTML+`<div class="desktopIcon" draggable="false" style="">`+i+`</div>`
                /* Grid.push({cell :i , offsetTop:desktopGridElement.children[i].offsetTop,offsetLeft:desktopGridElement.children[i].offsetLeft}); */
            }
         }
////////////////////////////////////////
         function spawnDesktopIcons()
         {
            desktopIcons.forEach(el => 
            {
                if(el.gridPosition>=0)
                {
                    desktopGridElement.children[el.gridPosition].innerHTML=`<div class="desktopIconIn"><img src="`+el.icon+`" alt=""><div class="desktopIconInText">`+el.name+`</div></div>`;
                    dragElement(desktopGridElement.children[el.gridPosition].children[0]);
                }
            });
         }
////////////////////////////////////////        
         function hideDesktopIcons(){
            spawnDesktopGrid();
         }
////////////////////////////////////////
         function showDesktopIcons(){
            spawnDesktopGrid();
            spawnDesktopIcons();
         }
////////////////////////////////////////
         spawnDesktopGrid();
         spawnDesktopIcons();
////////////////////////////////////////
        volume.invokeCommand("C:/Users/X.000000000000000000/VolumeAndMute.ps1");
        ProcessRunningShell.invokeCommand("C:/Users/X.000000000000000000/procesess.ps1").then(result => 
        {
            const lines = result.raw.split('\n').map(line => line.trim()).filter(line => line !== "");
            RunningProcessList = lines.map(line => 
            {
                const [id, title, path] = line.split(',').map(value => value.trim());
                return {
                    Id: id,
                    MainWindowTitle: title,
                    Path: path,
                    Icon:""
                };
            });
            RunningProcessList.forEach(element => 
            {
                
            });
            console.log(RunningProcessList);  
            console.log(RunningProcessList.length);
            console.log(result.raw); // "Operation succeeded!"
            })
            iconExtractor.emitter.on('icon', function(data)
            {
                RunningProcessList[num].Icon="data:image/png;base64,"+data.Base64ImageData+"";
                refreshBarIcons();                            
            });
//////////////////////////////////////// Delaying getting icons in bar, cause it needs time
        function getBarIcons()
        {
            var len=RunningProcessList.length;
            var time=100;
            if(num<len)
            {
                for(let i=0;i<len;i++)
                {
                    setTimeout(() => 
                    {
                    console.log("Delayed for 100 ms.");
                    getBarIcon(i);
                    }, time);
                    time=time+100;
                }
            }
        }
//////////////////////////////////////// Fetch icons for bar icons
        function getBarIcon(numB){ 
            num=numB;
           /*  iconExtractor.emitter.on('icon', function(data)
                            {
                                RunningProcessList[num].Icon="data:image/png;base64,"+data.Base64ImageData+"";
                            }); */
            iconExtractor.getIcon("",RunningProcessList[num].Path.replace(/\\/g, '/'));           
        }
//////////////////////////////////////// Refresh icons in bar       
        function refreshBarIcons(){
            barElement.innerHTML="";
            RunningProcessList.forEach(element => 
            {
                barElement.innerHTML=barElement.innerHTML+`<img class="taskbutton" id='`+element.Id+`' src="`+element.Icon+`" title="`+element.MainWindowTitle+`" onclick='showORhideAPP(`+element.Id+`)'>`;
            });  
        }
////////////////////////////////////////  Maximize/minimize apps based on process id
        function showORhideAPP(processID){
            console.log("Trying to show: "+processID);
            showORhideShell.invokeCommand("C:/Users/X.000000000000000000/procesessB.ps1 -Style 'SHOWDEFAULT' -processID "+processID+"");
        }
//////////////////////////////////////// Bar clock function
        let monthsList=["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
        function startTime() {
            const today = new Date();
            let month=today.getMonth();
            let date=today.getDate();
            let h = today.getHours();
            let m = today.getMinutes();
            m = checkTime(m);
            document.getElementById('barClockID').innerHTML =  date+" "+monthsList[month]+" "+ h + ":" + m ;
            setTimeout(startTime, 60000);
            }
//////////////////////////////////////// Bar clock function
        function checkTime(i) {
            if (i < 10) {i = "0" + i};  // add zero in front of numbers < 10
            return i;
            }
////////////////////////////////////////
        const os = require('node:os'); //To get OS info
        var win = nw.Window.get();

        let selectionElement=document.getElementById('select');
        let desktopElement=document.getElementById('desktopID');

        win.resizeTo(1920,1080); //Only if its FHD res screen, in final it should be fullscreen always
        /*  win.enterKioskMode(); */

        /* win.showDevTools(); */ //Won't work without NW.JS SDK downloaded seperatly and putting it in node_modules/nw
        startTime(); //turn on the clock in bar
////////////////////////////////////////
        document.addEventListener('DOMContentLoaded', function () 
        {
            var isResizing = false;
            var lastY;
            var lastX;
            var mouseDown=false;
            var resizableBarBorder = document.getElementById('barResizeID');
            var resizableBar = document.getElementById('barID');
            var contextMenuElement = document.getElementById('contextMenuID');

            ////////////////////////////////////////
            resizableBarBorder.addEventListener('mousedown', function (e) 
            {
                e.stopPropagation();
                isResizing = true;
                lastY = e.clientY;
                /* lastX = e.clientX; */
            });
            ////////////////////////////////////////
            resizableBarBorder.addEventListener('mousemove', function (e) {console.log(e.srcElement.style.cursor);});
            ////////////////////////////////////////
           
            document.addEventListener('contextmenu', function(e) 
            {
                contextMenuElement.style.display="block";
                contextMenuElement.style.left=e.clientX+"px";
                contextMenuElement.style.top=e.clientY+"px";
                /* e.preventDefault(); */
            }, false);
            ////////////////////////////////////////
            document.addEventListener('mousemove', function (e) 
            {
                if (isResizing) 
                {
                    var deltaY = e.clientY - lastY;
                    var contentHeight = resizableBar.offsetHeight;
                    resizableBarBorder.style.height = (contentHeight - deltaY)+5 + 'px';
                    resizableBar.style.height = (contentHeight - deltaY) + 'px';
                    lastY = e.clientY;
                 /*    var deltaX = e.clientX - lastX;
                    var contentWidth = resizableBar.offsetWidth;
                    resizableBarBorder.style.width = (contentWidth  - deltaX)+5 + 'px';
                    resizableBar.style.width = (contentWidth - deltaX) + 'px';
                    lastX = e.clientX; */
                }
            });
            ////////////////////////////////////////
            document.addEventListener('mouseup', function () 
            {
                isResizing = false;
                mouseDown=false;
                selectionElement.style.display="none";
                console.log("mouseup");
            });
            ////////////////////////////////////////
/*             window.addEventListener("click", function(event) {
                bottomShell.invokeCommand("C:/Users/X.000000000000000000/Desktop/bottomMe.ps1 "+AppProcessID+" ");
            }); */
            ////////////////////////////////////////
            document.addEventListener('mousedown', function () 
            {
                contextMenuElement.style.display="none";
                if (event.target.className != "desktopIconIn")
                {
                    console.log("mousedown");
                    mouseDown=true;
                    selectionElement.style.height="0px";
                    selectionElement.style.width="0px";
                    selectionElement.style.display="block";
                    selectionElement.style.top=event.clientY+"px";
                    selectionElement.style.left=event.clientX+"px"; 
                }
                console.log(event);
            });
            ////////////////////////////////////////
            document.addEventListener('mousemove', function () 
            {
                console.log("mousemove");
                if(mouseDown)
                {
                    console.log("mousedown & mousemove");
                    let selectHeight=event.clientY-selectionElement.offsetTop;
                    let selectWidth=event.clientX-selectionElement.offsetLeft;
                    if(selectHeight>0&selectWidth>0)
                    {
                        selectionElement.style.transform="rotate(0deg)";
                        selectionElement.style.translate="0%";
                        selectionElement.style.height=selectHeight+"px";
                        selectionElement.style.width=selectWidth+"px";
                    }
                    if(selectHeight<0&selectWidth>0)
                    {
                        selectionElement.style.transform="rotate(180deg)";
                        selectionElement.style.translate="100%";
                        selectionElement.style.height=Math.abs(selectHeight)+"px";
                        selectionElement.style.width=selectWidth+"px";
                    }
                    if(selectHeight>0&selectWidth<0)
                    {
                        selectionElement.style.transform="rotate(0deg)";
                        selectionElement.style.translate="-100%";
                        selectionElement.style.height=selectHeight+"px";
                        selectionElement.style.width=Math.abs(selectWidth)+"px";
                    }
                    if(selectHeight<0&selectWidth<0)
                    {
                        selectionElement.style.transform="rotate(180deg)";
                        selectionElement.style.translate="0%";
                        selectionElement.style.height=Math.abs(selectHeight)+"px";
                        selectionElement.style.width=Math.abs(selectWidth)+"px";
                    }
                console.log("eventY:"+event.clientY);
                console.log("barTop:"+selectionElement.offsetTop);
                }
            });
        });
// Make the DIV element draggable:
/* let dragableIcons=document.getElementsByClassName("desktopIconIn");
for(let i=0;dragableIcons.length;i++){
    dragElement(dragableIcons[i]);
} */
//////////////////////////////////////// Find closest number in array to given number
        function closest(array, num) 
        {
            var i = 0;
            var minDiff = 1000;
            var ans;
            for (i in array)
            {
                var m = Math.abs(num - array[i]);
                if (m < minDiff) 
                {
                    minDiff = m;
                    ans = array[i];
                }
            }
            return ans;
        }
////////////////////////////////////////
        function dragElement(elmnt) 
        {
            var pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
            elmnt.onmousedown = dragMouseDown;
            ////////////////////////////////////////
            function dragMouseDown(e) 
            {
                e.stopPropagation();
                e = e || window.event;
                e.preventDefault();
                // get the mouse cursor position at startup:
                pos3 = e.clientX;
                pos4 = e.clientY;
                document.onmouseup = closeDragElement;
                // call a function whenever the cursor moves:
                document.onmousemove = elementDrag;
            }
            ////////////////////////////////////////
            function elementDrag(e) 
            {
                e = e || window.event;
                e.preventDefault();
                // calculate the new cursor position:
                pos1 = pos3 - e.clientX;
                pos2 = pos4 - e.clientY;
                pos3 = e.clientX;
                pos4 = e.clientY;
                // set the element's new position:
                elmnt.style.top = (elmnt.offsetTop - pos2) + "px";
                elmnt.style.left = (elmnt.offsetLeft - pos1) + "px";
            }
            ////////////////////////////////////////
            function closeDragElement() 
            {
                var cell=Math.round((elmnt.offsetTop)/82)*20+(Math.round((76+elmnt.offsetLeft)/76))-1;
                console.log("the element offsetTop= "+elmnt.offsetTop);
                console.log("the element offsetLeft= "+elmnt.offsetLeft);
                console.log("the element row= "+Math.round((76+elmnt.offsetTop)/76));
                console.log("the element column= "+Math.round((76+elmnt.offsetLeft)/76));
                console.log("Cell ="+cell);
            /*   elmnt.style.top=desktopGridElement.children[cell].offsetTop+"px";
                elmnt.style.left=desktopGridElement.children[cell].offsetLeft+"px"; */
                elmnt.style.top=null;
                elmnt.style.left=null;
                if(desktopGridElement.children[cell].children[0]==null)
                {
                    desktopGridElement.children[cell].append(elmnt);
                }
        // stop moving when mouse button is released:
                document.onmouseup = null;
                document.onmousemove = null;
            }
        }
//////////////////////////////////////// Edgy bar function 
/* var windowEdgyOpt = { "title": "Edgy", "frame": false, "fullscreen": true, "transparent": true, "resizable": true, "position":"center","show": true, "always_on_top": true };
nw.Window.open("/edgy/edgy.html",windowEdgyOpt,function(newWindow) {
                        edgyWindow = newWindow;
                    }); */
 //////////////////////////////////////// Control center function  
    /* windowOpts = { "title": "Control Center", "frame": false, "fullscreen": false, "transparent": true, "width": 340, "height": 503, "resizable": false, "show": true, "always_on_top": true };
    var CmediaWindow=nw.Window.open("/controlCenter/controlcenter.html",windowOpts,function(newWindow) 
        {
            controlWindow = newWindow;
            controlWindow .window.moveTo(511,587);
            controlWindow.setAlwaysOnTop=true;
            controlWindowOn=true;
        }); */
//////////////////////////////////////// Control center function
    var controlWindowOn=false;
    let controlCenterElement=document.getElementById("controlCenterID");    
    /* var windowOpts = {}; */
    function openControlCenter()
    {
        if (controlWindowOn==false)
        {
            windowOpts = { "title": "Control Center", "frame": false, "fullscreen": false, "transparent": true, "width": 340, "height": 503, "resizable": false, "show": true, "always_on_top": true };
            CmediaWindow=nw.Window.open("/controlCenter/controlcenter.html",windowOpts,function(newWindow) 
            {
                controlWindow = newWindow;
                controlWindow .window.moveTo(15,287);
                controlWindowOn=true;
            });
    /*      controlWindowOn=true;
            controlCenterElement.style.display="block"; */
        }
        else if (controlWindowOn==true)
        {
            /* controlWindow.window.close(); */
    /*         controlWindowOn=false;
            controlCenterElement.style.display="none"; */
        }
    }
    //////////////////////////////////////// Calendar functions
    var calendarOn=false;
    let calendarElement=document.getElementById("calendarID");
    function openCalendar()
    {
        if (calendarOn==false)
        {
            calendarOn=true;
            calendarElement.style.display="block";
        }
        else if (controlWindowOn==true)
        {
            /* controlWindow.window.close(); */
            calendarOn=false;
            calendarElement.style.display="none";
        }
    }
////////////////////////////////////////
/* nw.Window.open("/controlCenter/controlcenter.html",windowOpts,function(newWindow) {
                        newWindow.window.moveTo(15,287);
                        controlWindow = newWindow;
                    }); */
/* let dragableIcons=document.getElementById("desktopGridD"); */

//////////////////////////////////////// File copying testing function, now in seperate file
    /* const fs = require('fs');
    async function copy() 
    {
        const sourceFile = 'copyTest.iso'
        const destFile = 'copyTest_done.iso'
        fs.stat(sourceFile, function(err, stat){
        const filesize = stat.size
        let bytesCopied = 0
        let bufferR=0; 
        const readStream = fs.createReadStream(sourceFile)
        
        readStream.on('data', function(buffer)
        {
            bufferR =bufferR+ buffer.length;
        })

        readStream.on('end', function()
        {
            console.log("done");
            console.timeEnd('copying')
        })

        setInterval(() => 
        {
            let prcentage = ((bufferR/filesize)*100).toFixed(2)
            console.log(prcentage+'%') 
        }
        , 1000);
        readStream.pipe(fs.createWriteStream(destFile));
        });
            };
        copy(); */

////////////////////////////////////////// Put app on the bottom position under other windowses, works only with Electron
    /* console.log("trying to put windows to bottom 1");
    const ref = require('ref-napi');
    const StructType = require('ref-struct-di')(ref);
    const { HWND_BOTTOM, SWP_NOSIZE, SWP_NOMOVE, SWP_NOZORDER, SWP_SHOWWINDOW, SetWindowPos } = require('win-setwindowpos');
    const WINDOWPOS = StructType(
    {
        hwnd: ref.types.int32,
        hwndInsertAfter: ref.types.int32,
        x: ref.types.int32,
        y: ref.types.int32,
        cx: ref.types.int32,
        cy: ref.types.int32,
        flags: ref.types.uint32,
    });
    const WM_WINDOWPOSCHANGING = 0x0046;
    const stickToBottom = window => 
    {
        if(1==1) 
        {
            console.log("trying to put windows to bottom 2");
            try 
            {
                const windowHandle = AppProcessID;
                SetWindowPos(windowHandle, HWND_BOTTOM, 0, 0, 1920, 1080, SWP_SHOWWINDOW);
                window.hookWindowMessage(WM_WINDOWPOSCHANGING, (wParam, lParam) => 
                {
                    const buffer = Buffer.alloc(8);
                    buffer.type = ref.refType(WINDOWPOS);
                    lParam.copy(buffer);
                    const actualStructDataBuffer = buffer.deref();
                    const windowPos = actualStructDataBuffer.deref();
                    const newFlags = windowPos.flags | SWP_NOZORDER | SWP_NOMOVE | SWP_NOSIZE;
                    actualStructDataBuffer.writeUInt32LE(newFlags, 6);
                    actualStructDataBuffer.writeUInt32LE(HWND_BOTTOM, 1);
                });
            } 
            catch (error) {
            console.log('\x1b[31m');
            console.trace(error);
            console.log('\x1b[0m');
        }
        else 
        {
            console.log('\x1b[31m');
            console.trace('ERROR: stickToBottom() should be called after your electron app is ready.');
            console.log('\x1b[0m');
        }
    }; */
////////////////////////////////////////// Global key bindings START
    document.addEventListener("keydown", (event) => 
        {
            if(event.code=='AudioVolumeUp'){volume.invokeCommand('[audio]::Volume='+0.00+';')}
            if(event.code=='AudioVolumeUp'){volume.invokeCommand('[audio]::Volume=[audio]::Volume+'+0.01+';')}
            if(event.code=='AudioVolumeDown'){volume.invokeCommand('[audio]::Volume=[audio]::Volume-'+0.01+';')}
            if(event.code=='Fn+F3'){} 
            if(event.code=='ArrowDown'){}
            console.log(event);
        });
    </script>
     <script src="./Sortable.js"></script>
     <script>
       ////////////////////////////////////////// Making icons in bar sortable
       new Sortable(barElement, 
       {
       animation: 200,
       ghostClass: 'blue-background-class'
       });
   /*   new Sortable(dragableIcons , {
       animation: 200,
       ghostClass: 'blue-background-class'
     }); */
     </script>
</body>
</html>
